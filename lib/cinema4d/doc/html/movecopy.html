<!-- HTML header -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>Move/Copy Constructors : Melange 19.0 SDK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<link href="msearch/css/msearch.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="msearch/js/msearch.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->

</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('movecopy.html','');});
</script>
<div id="doc-content">


<div class="header">
  <div class="headertitle">
<div class="title">Move/Copy Constructors </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page describes how to implement C++11 move and copy constructors in classes.</p>
<p>In the API there are strict requirements as to how classes need to be implemented, so that they can function e.g. with sort and array templates.</p>
<h1><a class="anchor" id="c1"></a>
Type I</h1>
<p>The first distinction is whether your class is a POD (plain old data) class or not.</p>
<p>POD classes can be copied as a whole by a simple <code>MemCopy()</code> and do not allocate any memory. POD classes do not require any special move/copy constructors.</p>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="namespacemelange.html#abee0cc4c1ceefe2081727b52784f8641">Vector</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <a class="code" href="group__c4d__system__datatypes.html#gad79e2aa671fc9eec4d03a5c55eec6ee6">Float</a> x,y,z;</div><div class="line">};</div></div><!-- fragment --><p>The arrays use type traits to automatically determine whether objects can be moved or copied with memmove()/memcpy(). To force a specific</p>
<dl class="section note"><dt>Note</dt><dd>For arrays and sorting you don't need to specify any special flags, but you can make use of <code>BASEARRAYFLAGS::MOVEANDCOPYOBJECTS</code> and <code>BASESORTFLAGS::MOVEANDCOPYOBJECTS</code> to increase copy &amp; move speed.</dd></dl>
<p><br />
 </p>
<h1><a class="anchor" id="c2"></a>
Type II</h1>
<p>For all other classes the first step is to use of the <code>MAXON_DISALLOW_COPY_AND_ASSIGN</code> macro at the beginning of the class. It declares the class copy constructor and operator private (not all compilers support C++11 deleted functions yet) and prevents copy and assign operations which implicitely expect success (or throw an exception).</p>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MemoryBlock</div><div class="line">{</div><div class="line">  MAXON_DISALLOW_COPY_AND_ASSIGN(MemoryBlock);</div><div class="line">  </div><div class="line"><span class="keyword">private</span>:</div><div class="line">  <span class="keywordtype">void</span>* _memory;</div><div class="line">  <a class="code" href="group__c4d__system__datatypes.html#gadb5eb0bfb4b5a3bea55989bf2635cbf1">Int</a>   _memorySize;</div><div class="line">};</div></div><!-- fragment --><p>To use such a class in combination with (most types of) arrays we need to define a move constructor and move assignment operator. Move constructors and operators define how to move the class in memory efficiently, without the need to copy the class and its contents.</p>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Example1</div><div class="line">{</div><div class="line">  MAXON_DISALLOW_COPY_AND_ASSIGN(Example1);</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  Example1() {}</div><div class="line">  ~Example1() {}</div><div class="line"></div><div class="line">  Example1(Example1&amp;&amp; src) : _data(std::move(src._data)) {}</div><div class="line">  MAXON_OPERATOR_MOVE_ASSIGNMENT(Example1);</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">  BaseArray&lt;Char&gt; _data;</div><div class="line">};</div></div><!-- fragment --><p>The statement <code>MAXON_OPERATOR_MOVE_ASSIGNMENT(className)</code> automatically defines the move assignment operator based on the move constructor, so we don't have to write the same code twice.</p>
<p>After defining the move constructor arrays or sorts can be used (otherwise you'd get a compile error in one of the header files):</p>
<div class="fragment"><div class="line">BaseArray&lt;Example1&gt; test;</div><div class="line">Example1* ptr = test.Append();</div></div><!-- fragment --><p>For derived classes the code is slightly more difficult to write:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Example2 : <span class="keyword">public</span> Example1</div><div class="line">{</div><div class="line">  MAXON_DISALLOW_COPY_AND_ASSIGN(Example2);</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  Example2() {}</div><div class="line"></div><div class="line">  Example2(Example2&amp;&amp; src) : Example1(std::move(src)), _val2(std::move(src._val2))</div><div class="line">  {</div><div class="line">    src._val2 = 0;</div><div class="line">  }</div><div class="line"></div><div class="line">  MAXON_OPERATOR_MOVE_ASSIGNMENT(Example2);</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">  <a class="code" href="group__c4d__system__datatypes.html#gadb5eb0bfb4b5a3bea55989bf2635cbf1">Int</a> _val2 = 1;</div><div class="line">};</div></div><!-- fragment --><p><br />
 </p>
<h1><a class="anchor" id="c3"></a>
Type III</h1>
<p>If your class does not only need to be moved in memory, but also needs to be copied or duplicated the member <code>CopyFrom()</code> needs to be added:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Example1</div><div class="line">{</div><div class="line">  MAXON_DISALLOW_COPY_AND_ASSIGN(Example1);</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  Example1() {}</div><div class="line">  ~Example1() {}</div><div class="line"></div><div class="line">  Example1(Example1&amp;&amp; src) : _data(std::move(src._data)) {}</div><div class="line">  MAXON_OPERATOR_MOVE_ASSIGNMENT(Example1);</div><div class="line"></div><div class="line">  MAXON_WARN_UNUSED Result&lt;void&gt; CopyFrom(<span class="keyword">const</span> Example1&amp; src)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (_data.CopyFrom(src._data) == maxon::FAILED)</div><div class="line">      <span class="keywordflow">return</span> OutOfMemoryError(CREATE);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> OK;</div><div class="line">  }</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">  BaseArray&lt;Char&gt; _data;</div><div class="line">};</div></div><!-- fragment --><p>Defining <code>CopyFrom()</code> is the only clean way to deal with out of memory situations, which cannot properly be tracked by using regular C++ copy constructors/operators without using exceptions.</p>
<p>After defining a <code>CopyFrom()</code> method you're now able to copy arrays:</p>
<div class="fragment"><div class="line">BaseArray&lt;Example1&gt; test, test2;</div><div class="line"><span class="keywordflow">if</span> (test.CopyFrom(test2) == maxon::FAILED)</div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div></div><!-- fragment --><p>or append data by copying it (though this is not the most efficient way to do):</p>
<div class="fragment"><div class="line">BaseArray&lt;Example1&gt; test;</div><div class="line">Example1 val;</div><div class="line"><span class="keywordflow">if</span> (test.Append(val) == <span class="keyword">nullptr</span>)</div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer -->
<!-- start footer part -->
<div id="nav-path" class="navpath"> <!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Copyright &copy; 2017 MAXON Computer GmbH. Visit <a href="https://developers.maxon.net/" target="_blank" style="text-decoration:underline;">developers.maxon.net</a> for the latest version. Last updated on Fri Nov 17 2017</li>
  </ul>
</div>
</body>
</html>
<!-- end footer part -->